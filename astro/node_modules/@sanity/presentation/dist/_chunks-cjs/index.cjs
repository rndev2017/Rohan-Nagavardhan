"use strict";var e=require("react/jsx-runtime"),t=require("react"),n=require("sanity"),o=require("@sanity/icons"),r=require("@sanity/ui"),s=require("styled-components"),i=require("rxjs"),a=require("sanity/router"),c=require("@sanity/uuid");const l=o.ComposeIcon,u="presentation",d="Presentation",p="presentation",m={locations:[]};const x="presentation",h=n.defineLocaleResourceBundle({locale:"en-US",namespace:x,resources:()=>Promise.resolve().then((function(){return require("./resources.cjs")}))}),f=t.createContext(null);function v(){const e=t.useContext(f);if(!e)throw new Error("Presentation context is missing");return e}const y={positive:o.InfoOutlineIcon,caution:o.WarningOutlineIcon,critical:o.ErrorOutlineIcon};function g(s){const{documentId:i,isResolving:a,options:c,schemaType:l,showPresentationTitle:p}=s,{locations:m,message:h,tone:v}=s.state,g=(null==m?void 0:m.length)||0,{t:I}=n.useTranslation(x),b=t.useContext(f),[C,w]=t.useState(!1),P=t.useCallback((()=>{g&&w((e=>!e))}),[g]),T=a?I("locations-banner.resolving.text"):h||I("locations-banner.locations-count",{count:g});return e.jsx(r.Card,{padding:1,radius:2,border:!0,tone:v,children:e.jsxs("div",{style:{margin:-1},children:[!m&&e.jsxs(r.Flex,{align:"flex-start",gap:3,padding:3,children:[v&&e.jsx(r.Box,{flex:"none",children:e.jsx(r.Text,{size:1,children:t.createElement(y[v])})}),e.jsx(r.Box,{flex:1,children:e.jsxs(r.Text,{size:1,weight:"medium",children:[p&&e.jsxs(e.Fragment,{children:[c.title||d," · "]}),T]})})]}),m&&e.jsxs(e.Fragment,{children:[e.jsx(r.Card,{as:g?"button":void 0,onClick:P,padding:3,radius:1,tone:"inherit",children:e.jsxs(r.Flex,{gap:3,children:[e.jsx(r.Box,{flex:"none",children:a?e.jsx(r.Spinner,{size:1}):e.jsx(r.Text,{size:1,children:0===g?e.jsx(o.InfoOutlineIcon,{}):e.jsx(o.ChevronRightIcon,{style:{transform:`rotate(${C?"90deg":0})`,transition:"transform 100ms ease-in-out"}})})}),e.jsx(r.Box,{flex:1,children:e.jsxs(r.Text,{size:1,weight:"medium",children:[p&&e.jsxs(e.Fragment,{children:[c.title||d," · "]}),T]})})]})}),e.jsx(r.Stack,{hidden:!C,marginTop:1,space:1,children:m.map(((t,n)=>e.jsx(j,{active:(c.name||u)===(null==b?void 0:b.name)&&t.href===(null==b?void 0:b.params.preview),documentId:i,documentType:l.name,node:t,toolName:c.name||u},n)))})]})]})})}function j(n){const{documentId:s,documentType:i,node:c,active:l,toolName:u}=n,d=t.useContext(f),p=u===function(){try{return v().name}catch{return}}(),m=null==d?void 0:d.navigate,x=a.useIntentLink({intent:"edit",params:{id:s,type:i,mode:"presentation",presentation:u,...null==d?void 0:d.structureParams,preview:c.href}}),h=t.useCallback((()=>{null==m||m({},{preview:c.href})}),[c.href,m]);return t.createElement(r.Card,{...p?{}:x,as:"a",key:c.href,onClick:p?h:x.onClick,padding:3,radius:1,pressed:l,tone:"inherit"},e.jsxs(r.Flex,{gap:3,children:[e.jsx(r.Box,{flex:"none",children:e.jsx(r.Text,{size:1,children:e.jsx(o.DesktopIcon,{})})}),e.jsxs(r.Stack,{flex:1,space:2,children:[e.jsx(r.Text,{size:1,weight:"medium",children:c.title}),e.jsx(r.Text,{muted:!0,size:1,textOverflow:"ellipsis",children:c.href})]})]}))}const I=t.createContext(null),b=s.styled(r.Stack)`
  min-height: ${r.rem(42)};

  & + &:empty {
    display: none;
  }
`;function C(o){var s;const{documentId:a,options:c,schemaType:l}=o,u=t.useContext(I),{state:d,status:p}=function(e){const{id:o,resolvers:r,type:s}=e,a=n.useDocumentStore(),[c,l]=t.useState(m),u=r&&("function"==typeof r?r:r[s]),[d,p]=t.useState(u?"resolving":"empty"),x=t.useMemo((()=>{if(u){if("function"==typeof u){const e=u({id:o,type:s},{documentStore:a});return i.isObservable(e)?e:i.of(e)}if("select"in u&&"resolve"in u){const e=`*[_id==$id][0]{${Object.entries(u.select).map((([e,t])=>`"${e}": ${t}`)).join(", ")}}`,t={id:o};return a.listenQuery(e,t,{perspective:"previewDrafts"}).pipe(i.map(u.resolve))}return i.of(u)}}),[a,o,u,s]);return t.useEffect((()=>{const e=null==x?void 0:x.subscribe((e=>{l(e||m),p(e?"resolved":"empty")}));return()=>null==e?void 0:e.unsubscribe()}),[x]),{state:c,status:d}}({id:a,resolvers:(null==(s=c.resolve)?void 0:s.locations)||c.locate,type:l.name});if(u&&u.options[0]!==c||"empty"===p)return null;const x=(null==u?void 0:u.options)||[];return e.jsx(b,{marginBottom:5,space:5,children:e.jsx(r.Stack,{space:2,children:x.map(((t,n)=>e.jsx(g,{documentId:a,isResolving:"resolving"===p,options:t,schemaType:l,showPresentationTitle:x.length>1,state:d},n)))})})}function w(n){const{children:o,options:r}=n,s=t.useContext(I),i=null==s?void 0:s.register,[a,c]=t.useState((()=>[])),l=t.useCallback((e=>i?i(e):(c((t=>[e].concat(t))),()=>{c((t=>t.filter((t=>t!==e))))})),[i]),u=t.useRef(l);u.current=l;const d=t.useMemo((()=>({options:(null==s?void 0:s.options)||a,register:l})),[a,s,l]);return t.useLayoutEffect((()=>u.current(r)),[r]),e.jsx(I.Provider,{value:d,children:o})}const P=n.defineDocumentFieldAction({name:"presentation/openInStructure",useAction({documentId:e,documentType:r,path:s}){const i=n.useWorkspace(),{navigateIntent:c}=a.useRouter(),l=t.useContext(f),u=t.useMemo((()=>function(e,t,o){var r;const s=e.map((e=>{var n;return{tool:e,match:null==(n=e.canHandleIntent)?void 0:n.call(e,"edit",{id:t,type:o,mode:"structure"},{})}})),i=s.filter((e=>n.isRecord(e.match)&&e.match.mode));return i.length>0?i[0].tool:null==(r=s.filter((e=>e.match))[0])?void 0:r.tool}(i.tools,e,r)),[e,r,i.tools]);return{type:"action",hidden:!l||s.length>0||!u,icon:(null==u?void 0:u.icon)||o.MasterDetailIcon,title:`Open in ${(null==u?void 0:u.title)||"Structure"}`,onAction(){c("edit",{id:e,type:r,mode:"structure",path:n.pathToString(s)})},renderAsButton:!0}}});function T(e,t,o,r){const{id:s,mode:i,path:l,presentation:u,type:d,...p}=t;return"edit"===e&&s?{type:d||"*",id:n.getPublishedId(s),path:l,_searchParams:Object.entries(p)}:"create"===e?(p.preview=p.preview||new URLSearchParams(window.location.search).get("preview")||"/",r&&"object"==typeof r&&(p.templateParams=a.encodeJsonParams(r)),{type:d||"*",id:s||c.uuid(),_searchParams:Object.entries(p)}):{intent:e,params:t,payload:r}}const S=a.route.create("/",{__unsafe_disableScopedSearchParams:!0},[a.route.intents("/intent"),a.route.create(":type",[a.route.create(":id",[a.route.create(":path")])])]),k=t.lazy((()=>Promise.resolve().then((function(){return require("./PresentationTool.cjs")})))),q=t.lazy((()=>Promise.resolve().then((function(){return require("./BroadcastDisplayedDocument.cjs")}))));const D=n.definePlugin((o=>{var r;const s=o.name||u;"locate"in o&&console.warn("Presentation’s `locate` option is deprecated. Use `resolve.locations` instead.");const i=!!(null!=(r=o.resolve)&&r.locations||o.locate);return{i18n:{bundles:[h]},document:{unstable_fieldActions:e=>[...e.filter((e=>e.name!==P.name)),P]},form:{components:{input:function(r){const s=r.value,a=null!=s&&s._id?n.getPublishedId(null==s?void 0:s._id):void 0;return n.isDocumentSchemaType(r.schemaType)?e.jsxs(w,{options:o,children:[i&&a&&e.jsx(C,{documentId:a,options:o,schemaType:r.schemaType}),r.renderDefault(r),e.jsx(t.Suspense,{children:e.jsx(q,{value:s},a)},"broadcast-displayed-document")]}):r.renderDefault(r)}}},tools:[{icon:o.icon||l,name:s,title:o.title,component:k,options:o,canHandleIntent:(e,t)=>"create"===e?function(e){return"type"in e&&(!("presentation"in e)||e.presentation===s)&&(!("template"in e)||{template:!0})}(t):"edit"===e&&function(e){return"type"in e&&"id"in e&&(!("presentation"in e)||e.presentation===s)&&(!("mode"in e)||{mode:e.mode===p})}(t),getIntentState:T,router:S}]}})),z=t.createContext(null);const O=t.createContext(null);exports.A="2023-10-16",exports.C="sanity/structure/comments",exports.D=u,exports.E=p,exports.L=2048,exports.M=3e3,exports.P=z,exports.a=O,exports.b=f,exports.c=1e3,exports.d=function(e=!0){const n=t.useContext(O);if(e&&!n)throw new Error("Presentation params context is missing");return n},exports.e=100,exports.f=function(){const e=t.useContext(z);if(!e)throw new Error("Presentation navigate context is missing");return e},exports.g=function(e){return e},exports.h=function(e){return e},exports.i=D,exports.p=x,exports.u=v;//# sourceMappingURL=index.cjs.map
