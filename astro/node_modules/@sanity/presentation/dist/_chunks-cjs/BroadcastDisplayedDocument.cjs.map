{"version":3,"file":"BroadcastDisplayedDocument.cjs","sources":["../../src/loader/BroadcastDisplayedDocument.tsx"],"sourcesContent":["import {memo, useEffect} from 'react'\nimport type {SanityDocument} from 'sanity'\n\nimport {useDocumentPane} from '../internals'\nimport type {PresentationParams} from '../types'\nimport {usePresentationParams} from '../usePresentationParams'\nimport {\n  type SetDisplayedDocument,\n  useDisplayedDocumentBroadcaster,\n} from './DisplayedDocumentBroadcaster'\n\n/**\n * Sanity Form input component that reads the current form state and broadcasts it to\n * the live query store\n */\nfunction BroadcastDisplayedDocument(props: {\n  value: Partial<SanityDocument> | null | undefined\n}): JSX.Element | null {\n  const setDisplayedDocument = useDisplayedDocumentBroadcaster()\n  const params = usePresentationParams(false)\n\n  useEffect(() => {\n    if (params?.perspective !== 'published') {\n      const timeout = setTimeout(() => setDisplayedDocument?.(props.value), 10)\n      return () => clearTimeout(timeout)\n    }\n    return\n  }, [params?.perspective, props.value, setDisplayedDocument])\n\n  if (params?.perspective === 'published') {\n    return (\n      <BroadcastPublishedDocument\n        params={params}\n        setDisplayedDocument={setDisplayedDocument}\n        value={props.value}\n      />\n    )\n  }\n\n  return null\n}\n\nexport default memo(BroadcastDisplayedDocument)\n\nfunction BroadcastPublishedDocument(props: {\n  params: PresentationParams\n  setDisplayedDocument: SetDisplayedDocument | null\n  value: Partial<SanityDocument> | null | undefined\n}) {\n  const {params, setDisplayedDocument, value} = props\n  const {editState} = useDocumentPane()\n\n  useEffect(() => {\n    if ((editState?.published && !params?.prefersLatestPublished) || !editState?.published) {\n      const timeout = setTimeout(() => setDisplayedDocument?.(value), 100)\n      return () => clearTimeout(timeout)\n    }\n    return\n  }, [editState?.published, params?.prefersLatestPublished, setDisplayedDocument, value])\n\n  return null\n}\n"],"names":["BroadcastDisplayedDocument$1","memo","props","setDisplayedDocument","useDisplayedDocumentBroadcaster","params","usePresentationParams","useEffect","perspective","timeout","setTimeout","value","clearTimeout","jsxRuntime","jsx","BroadcastPublishedDocument","editState","useDocumentPane","published","prefersLatestPublished","exports","default"],"mappings":"0KA0CA,IAAAA,EAAeC,QA3Bf,SAAoCC,GAGlC,MAAMC,EAAuBC,EAAAA,IACvBC,EAASC,KAAsB,GAErCC,OAAAA,aAAU,KACJ,GAAwB,eAAxB,MAAAF,OAAA,EAAAA,EAAQG,aAA6B,CACjC,MAAAC,EAAUC,YAAW,IAA6B,MAAvBP,OAAuB,EAAAA,EAAAD,EAAMS,QAAQ,IAC/D,MAAA,IAAMC,aAAaH,EAC5B,IAEC,CAAC,MAAAJ,OAAA,EAAAA,EAAQG,YAAaN,EAAMS,MAAOR,IAEV,eAAhB,MAARE,OAAQ,EAAAA,EAAAG,aAERK,EAAAC,IAACC,EAAA,CACCV,SACAF,uBACAQ,MAAOT,EAAMS,QAKZ,IACT,IAIA,SAASI,EAA2Bb,GAK5B,MAAAG,OAACA,EAAQF,qBAAAA,EAAAQ,MAAsBA,GAAST,GACxCc,UAACA,GAAaC,EAAAA,kBAEpBV,OAAAA,EAAAA,WAAU,KACR,SAAKS,KAAWE,kBAAcb,MAAQc,+BAA4BH,MAAWE,UAAW,CAChF,MAAAT,EAAUC,YAAW,IAAM,MAAAP,OAAA,EAAAA,EAAuBQ,IAAQ,KACzD,MAAA,IAAMC,aAAaH,EAC5B,IAEC,CAAY,MAAXO,OAAW,EAAAA,EAAAE,gBAAWb,WAAQc,uBAAwBhB,EAAsBQ,IAEzE,IACT,CAAAS,QAAAC,QAAArB"}