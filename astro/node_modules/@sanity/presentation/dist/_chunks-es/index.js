import{jsx as e,jsxs as t,Fragment as n}from"react/jsx-runtime";import{useState as i,useMemo as o,useEffect as r,createContext as s,useContext as a,useCallback as c,createElement as l,useRef as d,useLayoutEffect as u,lazy as p,Suspense as m}from"react";import{useDocumentStore as h,defineLocaleResourceBundle as f,useTranslation as v,defineDocumentFieldAction as y,useWorkspace as g,pathToString as w,isRecord as b,getPublishedId as P,definePlugin as x,isDocumentSchemaType as T}from"sanity";import{ComposeIcon as I,InfoOutlineIcon as j,ChevronRightIcon as _,DesktopIcon as z,WarningOutlineIcon as S,ErrorOutlineIcon as $,MasterDetailIcon as D}from"@sanity/icons";import{Card as A,Flex as O,Box as k,Text as C,Spinner as E,Stack as B,rem as R}from"@sanity/ui";import{styled as U}from"styled-components";import{isObservable as H,of as L,map as N}from"rxjs";import{useIntentLink as M,useRouter as Q,encodeJsonParams as q,route as F}from"sanity/router";import{uuid as G}from"@sanity/uuid";const J=I,K="presentation",V="Presentation",W="sanity/structure/comments",X="presentation",Y=3e3,Z="2023-10-16",ee=1e3,te=100,ne=2048,ie={locations:[]};const oe="presentation",re=f({locale:"en-US",namespace:oe,resources:()=>import("./resources.js")}),se=s(null);function ae(){const e=a(se);if(!e)throw new Error("Presentation context is missing");return e}const ce={positive:j,caution:S,critical:$};function le(o){const{documentId:r,isResolving:s,options:d,schemaType:u,showPresentationTitle:p}=o,{locations:m,message:h,tone:f}=o.state,y=(null==m?void 0:m.length)||0,{t:g}=v(oe),w=a(se),[b,P]=i(!1),x=c((()=>{y&&P((e=>!e))}),[y]),T=s?g("locations-banner.resolving.text"):h||g("locations-banner.locations-count",{count:y});return e(A,{padding:1,radius:2,border:!0,tone:f,children:t("div",{style:{margin:-1},children:[!m&&t(O,{align:"flex-start",gap:3,padding:3,children:[f&&e(k,{flex:"none",children:e(C,{size:1,children:l(ce[f])})}),e(k,{flex:1,children:t(C,{size:1,weight:"medium",children:[p&&t(n,{children:[d.title||V," · "]}),T]})})]}),m&&t(n,{children:[e(A,{as:y?"button":void 0,onClick:x,padding:3,radius:1,tone:"inherit",children:t(O,{gap:3,children:[e(k,{flex:"none",children:s?e(E,{size:1}):e(C,{size:1,children:0===y?e(j,{}):e(_,{style:{transform:`rotate(${b?"90deg":0})`,transition:"transform 100ms ease-in-out"}})})}),e(k,{flex:1,children:t(C,{size:1,weight:"medium",children:[p&&t(n,{children:[d.title||V," · "]}),T]})})]})}),e(B,{hidden:!b,marginTop:1,space:1,children:m.map(((t,n)=>e(de,{active:(d.name||K)===(null==w?void 0:w.name)&&t.href===(null==w?void 0:w.params.preview),documentId:r,documentType:u.name,node:t,toolName:d.name||K},n)))})]})]})})}function de(n){const{documentId:i,documentType:o,node:r,active:s,toolName:d}=n,u=a(se),p=d===function(){try{return ae().name}catch{return}}(),m=null==u?void 0:u.navigate,h=M({intent:"edit",params:{id:i,type:o,mode:"presentation",presentation:d,...null==u?void 0:u.structureParams,preview:r.href}}),f=c((()=>{null==m||m({},{preview:r.href})}),[r.href,m]);return l(A,{...p?{}:h,as:"a",key:r.href,onClick:p?f:h.onClick,padding:3,radius:1,pressed:s,tone:"inherit"},t(O,{gap:3,children:[e(k,{flex:"none",children:e(C,{size:1,children:e(z,{})})}),t(B,{flex:1,space:2,children:[e(C,{size:1,weight:"medium",children:r.title}),e(C,{muted:!0,size:1,textOverflow:"ellipsis",children:r.href})]})]}))}const ue=s(null),pe=U(B)`
  min-height: ${R(42)};

  & + &:empty {
    display: none;
  }
`;function me(t){var n;const{documentId:s,options:c,schemaType:l}=t,d=a(ue),{state:u,status:p}=function(e){const{id:t,resolvers:n,type:s}=e,a=h(),[c,l]=i(ie),d=n&&("function"==typeof n?n:n[s]),[u,p]=i(d?"resolving":"empty"),m=o((()=>{if(d){if("function"==typeof d){const e=d({id:t,type:s},{documentStore:a});return H(e)?e:L(e)}if("select"in d&&"resolve"in d){const e=`*[_id==$id][0]{${Object.entries(d.select).map((([e,t])=>`"${e}": ${t}`)).join(", ")}}`,n={id:t};return a.listenQuery(e,n,{perspective:"previewDrafts"}).pipe(N(d.resolve))}return L(d)}}),[a,t,d,s]);return r((()=>{const e=null==m?void 0:m.subscribe((e=>{l(e||ie),p(e?"resolved":"empty")}));return()=>null==e?void 0:e.unsubscribe()}),[m]),{state:c,status:u}}({id:s,resolvers:(null==(n=c.resolve)?void 0:n.locations)||c.locate,type:l.name});if(d&&d.options[0]!==c||"empty"===p)return null;const m=(null==d?void 0:d.options)||[];return e(pe,{marginBottom:5,space:5,children:e(B,{space:2,children:m.map(((t,n)=>e(le,{documentId:s,isResolving:"resolving"===p,options:t,schemaType:l,showPresentationTitle:m.length>1,state:u},n)))})})}function he(t){const{children:n,options:r}=t,s=a(ue),l=null==s?void 0:s.register,[p,m]=i((()=>[])),h=c((e=>l?l(e):(m((t=>[e].concat(t))),()=>{m((t=>t.filter((t=>t!==e))))})),[l]),f=d(h);f.current=h;const v=o((()=>({options:(null==s?void 0:s.options)||p,register:h})),[p,s,h]);return u((()=>f.current(r)),[r]),e(ue.Provider,{value:v,children:n})}const fe=y({name:"presentation/openInStructure",useAction({documentId:e,documentType:t,path:n}){const i=g(),{navigateIntent:r}=Q(),s=a(se),c=o((()=>function(e,t,n){var i;const o=e.map((e=>{var i;return{tool:e,match:null==(i=e.canHandleIntent)?void 0:i.call(e,"edit",{id:t,type:n,mode:"structure"},{})}})),r=o.filter((e=>b(e.match)&&e.match.mode));return r.length>0?r[0].tool:null==(i=o.filter((e=>e.match))[0])?void 0:i.tool}(i.tools,e,t)),[e,t,i.tools]);return{type:"action",hidden:!s||n.length>0||!c,icon:(null==c?void 0:c.icon)||D,title:`Open in ${(null==c?void 0:c.title)||"Structure"}`,onAction(){r("edit",{id:e,type:t,mode:"structure",path:w(n)})},renderAsButton:!0}}});function ve(e,t,n,i){const{id:o,mode:r,path:s,presentation:a,type:c,...l}=t;return"edit"===e&&o?{type:c||"*",id:P(o),path:s,_searchParams:Object.entries(l)}:"create"===e?(l.preview=l.preview||new URLSearchParams(window.location.search).get("preview")||"/",i&&"object"==typeof i&&(l.templateParams=q(i)),{type:c||"*",id:o||G(),_searchParams:Object.entries(l)}):{intent:e,params:t,payload:i}}const ye=F.create("/",{__unsafe_disableScopedSearchParams:!0},[F.intents("/intent"),F.create(":type",[F.create(":id",[F.create(":path")])])]),ge=p((()=>import("./PresentationTool.js"))),we=p((()=>import("./BroadcastDisplayedDocument.js")));function be(e){return e}function Pe(e){return e}const xe=x((n=>{var i;const o=n.name||K;"locate"in n&&console.warn("Presentation’s `locate` option is deprecated. Use `resolve.locations` instead.");const r=!!(null!=(i=n.resolve)&&i.locations||n.locate);return{i18n:{bundles:[re]},document:{unstable_fieldActions:e=>[...e.filter((e=>e.name!==fe.name)),fe]},form:{components:{input:function(i){const o=i.value,s=null!=o&&o._id?P(null==o?void 0:o._id):void 0;return T(i.schemaType)?t(he,{options:n,children:[r&&s&&e(me,{documentId:s,options:n,schemaType:i.schemaType}),i.renderDefault(i),e(m,{children:e(we,{value:o},s)},"broadcast-displayed-document")]}):i.renderDefault(i)}}},tools:[{icon:n.icon||J,name:o,title:n.title,component:ge,options:n,canHandleIntent:(e,t)=>"create"===e?function(e){return"type"in e&&(!("presentation"in e)||e.presentation===o)&&(!("template"in e)||{template:!0})}(t):"edit"===e&&function(e){return"type"in e&&"id"in e&&(!("presentation"in e)||e.presentation===o)&&(!("mode"in e)||{mode:e.mode===X})}(t),getIntentState:ve,router:ye}]}})),Te=s(null);function Ie(){const e=a(Te);if(!e)throw new Error("Presentation navigate context is missing");return e}const je=s(null);function _e(e=!0){const t=a(je);if(e&&!t)throw new Error("Presentation params context is missing");return t}export{Z as A,W as C,K as D,X as E,ne as L,Y as M,Te as P,je as a,se as b,ee as c,_e as d,te as e,Ie as f,be as g,Pe as h,xe as i,oe as p,ae as u};//# sourceMappingURL=index.js.map
