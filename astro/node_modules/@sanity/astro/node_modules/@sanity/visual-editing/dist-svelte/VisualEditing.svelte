<script>"use strict";
import { onMount } from "svelte";
import {
  enableVisualEditing
} from "../dist/index.js";
import { afterNavigate, goto, invalidateAll } from "$app/navigation";
export let zIndex = void 0;
export let refresh = void 0;
let navigate;
let navigatingFromUpdate = false;
onMount(
  () => enableVisualEditing({
    zIndex,
    refresh: (payload) => {
      function refreshDefault() {
        if (payload.source === "mutation" && payload.livePreviewEnabled) {
          return false;
        }
        return new Promise(async (resolve) => {
          await invalidateAll();
          resolve();
        });
      }
      return refresh ? refresh(payload, refreshDefault) : refreshDefault();
    },
    history: {
      subscribe: (_navigate) => {
        navigate = _navigate;
        navigate({
          type: "replace",
          url: window.location.pathname + window.location.search
        });
        return () => {
          navigate = void 0;
        };
      },
      update: (update) => {
        if (update.type === "push" || update.type === "replace") {
          navigatingFromUpdate = true;
          goto(update.url, { replaceState: update.type === "replace" });
        } else if (update.type === "pop") {
          history.back();
        }
      }
    }
  })
);
afterNavigate(async ({ to, complete }) => {
  if (navigate && to && !navigatingFromUpdate) {
    await complete;
    navigate({ type: "push", url: to.url.pathname + to.url.search });
  }
  navigatingFromUpdate = false;
});
</script>
