import{getPublishedId as t,studioPath as e}from"@sanity/client/csm";import{string as r,minLength as o,optional as n,object as a,record as i,unknown as s,is as c,safeParse as u,parse as p}from"valibot";function f(t){return null!==t&&Array.isArray(t)}function d(t){let e="";for(const r of t)"string"!=typeof r?"number"!=typeof r?f(r)?(e&&(e+=":"),e+=`${r.join(",")}}`):r._key&&(e&&(e+=":"),e+=`${r._key}`):(e&&(e+=":"),e+=`${r}`):(e&&(e+="."),e+=r);return e}const h=/^([A-Za-z]+):([0-9]+)$/,l=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,y=/^([A-Za-z]+):([a-z0-9]+)$/;const b="drafts.",m=r([o(1)]),k=n(m),w=a({baseUrl:m,dataset:k,id:m,path:m,projectId:k,tool:k,type:k,workspace:k,isDraft:n(r())}),g=a({origin:m,href:m,data:n(i(r(),s()))});function U(t){return c(w,t)}function j(t){const r=t.split(";").reduce(((t,r)=>{const[o,n]=r.split("=");if(!o||r.includes("=")&&!n)return t;switch(o){case"id":t.id=n;break;case"type":t.type=n;break;case"path":t.path=e.toString(function(t){const e=[];for(const r of t.split(".")){const t=h.exec(r);if(t){e.push(t[1],Number(t[2]));continue}const o=l.exec(r);if(o){e.push(o[1],[Number(o[2]),Number(o[3])]);continue}const n=y.exec(r);n?e.push(n[1],{_key:n[2]}):e.push(r)}return e}(n));break;case"base":t.baseUrl=decodeURIComponent(n);break;case"tool":t.tool=n;break;case"workspace":t.workspace=n;break;case"projectId":t.projectId=n;break;case"dataset":t.dataset=n;break;case"isDraft":t.isDraft=""}return t}),{});if(U(r))return r}function A(t){const e=u(w,t);if(e.success)return e.output;const r=u(g,t);if(r.success)try{const t=new URL(r.output.href,typeof document>"u"?"https://example.com":location.origin);return t.searchParams.size>0?p(w,Object.fromEntries(t.searchParams.entries())):r.output}catch(t){return console.error("Failed to parse sanity node",t),r.output}}function S(t){if("object"==typeof t&&null!==t)return A(t);try{return A(JSON.parse(t))}catch{return j(t)}}function $(r){function o(t){return t?"string"==typeof t?e.fromString(t):t:[]}function n(r){if(!r.id)throw new Error("`id` is required to create a data attribute");if(!r.type)throw new Error("`type` is required to create a data attribute");if(!r.path||!r.path.length)throw new Error("`path` is required to create a data attribute");return function(r){const{id:o,path:n,baseUrl:a,tool:i,workspace:s,type:c}=r;return U(r)?[["id",t(o)],["type",c],["path",d(e.fromString(n))],["base",encodeURIComponent(a)],["workspace",s],["tool",i],["isDraft",o.startsWith(b)]].filter((([,t])=>!!t)).map((t=>{const[e,r]=t;return!0===r?e:t.join("=")})).join(";"):void 0}({baseUrl:r.baseUrl||"/",workspace:r.workspace,tool:r.tool,type:r.type,id:r.id,path:"string"==typeof r.path?r.path:e.toString(r.path)})}const a=t=>n({...r,path:[...o(r.path),...o(t)]});return a.toString=function(){return n(r)},a.combine=function(t){return $({...r,...t})},a.scope=function(t){return $({...r,path:[...o(r.path),...o(t)]})},a}const x={alt:"altKey",ctrl:"ctrlKey",mod:typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)?"metaKey":"ctrlKey",shift:"shiftKey"};function z(t,e){return t.every((t=>x[t]?e[x[t]]:e.key===t.toUpperCase()))}function I(t){return"Alt"===t.key}export{S as I,I as c,d,b as k,$ as o,z as p};//# sourceMappingURL=create-data-attribute.js.map
