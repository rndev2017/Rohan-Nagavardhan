{"version":3,"file":"VisualEditingComponent.js","sources":["../../src/next-pages-router/VisualEditingComponent.tsx"],"sourcesContent":["import {useRouter} from 'next/router.js'\nimport {useEffect, useRef, useState} from 'react'\n\nimport type {HistoryAdapterNavigate, VisualEditingOptions} from '../types'\nimport {enableVisualEditing} from '../ui/enableVisualEditing'\n\n/**\n * @public\n */\nexport interface VisualEditingProps extends Omit<VisualEditingOptions, 'history'> {\n  /**\n   * @deprecated The histoy adapter is already implemented\n   */\n  history?: never\n}\n\nexport default function VisualEditingComponent(props: VisualEditingProps): null {\n  const {refresh, zIndex} = props\n\n  const router = useRouter()\n  const routerRef = useRef(router)\n  const [navigate, setNavigate] = useState<HistoryAdapterNavigate | undefined>()\n\n  useEffect(() => {\n    routerRef.current = router\n  }, [router])\n  useEffect(() => {\n    const disable = enableVisualEditing({\n      zIndex,\n      refresh,\n      history: {\n        subscribe: (_navigate) => {\n          setNavigate(() => _navigate)\n          return () => setNavigate(undefined)\n        },\n        update: (update) => {\n          switch (update.type) {\n            case 'push':\n              return routerRef.current.push(update.url)\n            case 'pop':\n              return routerRef.current.back()\n            case 'replace':\n              return routerRef.current.replace(update.url)\n            default:\n              throw new Error(`Unknown update type: ${update.type}`)\n          }\n        },\n      },\n    })\n    return () => disable()\n  }, [refresh, zIndex])\n\n  const {asPath, basePath, locale, isReady} = useRouter()\n  useEffect(() => {\n    if (navigate && isReady) {\n      const url =\n        basePath || locale\n          ? `${basePath}${locale ? `/${locale}` : ''}${asPath === '/' ? '' : asPath}`\n          : asPath\n      navigate({type: 'push', url})\n    }\n  }, [asPath, basePath, isReady, locale, navigate])\n\n  return null\n}\n"],"names":["VisualEditingComponent","props","refresh","zIndex","router","useRouter","routerRef","useRef","navigate","setNavigate","useState","useEffect","current","disable","enableVisualEditing","history","subscribe","_navigate","update","type","push","url","back","replace","Error","asPath","basePath","locale","isReady"],"mappings":"oJAgBA,SAAwBA,EAAuBC,GAC7C,MAAMC,QAACA,EAASC,OAAAA,GAAUF,EAEpBG,EAASC,IACTC,EAAYC,EAAOH,IAClBI,EAAUC,GAAeC,IAEhCC,GAAU,KACRL,EAAUM,QAAUR,CAAA,GACnB,CAACA,IACJO,GAAU,KACR,MAAME,EAAUC,EAAoB,CAClCX,SACAD,UACAa,QAAS,CACPC,UAAYC,IACVR,GAAY,IAAMQ,IACX,IAAMR,OAAY,IAE3BS,OAASA,IACP,OAAQA,EAAOC,MACb,IAAK,OACH,OAAOb,EAAUM,QAAQQ,KAAKF,EAAOG,KACvC,IAAK,MACI,OAAAf,EAAUM,QAAQU,OAC3B,IAAK,UACH,OAAOhB,EAAUM,QAAQW,QAAQL,EAAOG,KAC1C,QACE,MAAM,IAAIG,MAAM,wBAAwBN,EAAOC,QACnD,KAIN,MAAO,IAAMN,GAAQ,GACpB,CAACX,EAASC,IAEb,MAAMsB,OAACA,EAAQC,SAAAA,EAAAC,OAAUA,EAAQC,QAAAA,GAAWvB,IAC5C,OAAAM,GAAU,KACR,GAAIH,GAAYoB,EAAS,CAKvBpB,EAAS,CAACW,KAAM,OAAQE,IAHtBK,GAAYC,EACR,GAAGD,IAAWC,EAAS,IAAIA,IAAW,KAAgB,MAAXF,EAAiB,GAAKA,IACjEA,GAER,IACC,CAACA,EAAQC,EAAUE,EAASD,EAAQnB,IAEhC,IACT"}