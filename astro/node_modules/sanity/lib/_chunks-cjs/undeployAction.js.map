{"version":3,"file":"undeployAction.js","sources":["../../src/_internal/cli/actions/deploy/undeployAction.ts"],"sourcesContent":["import {type CliCommandArguments, type CliCommandContext} from '@sanity/cli'\n\nexport default async function undeployStudio(\n  args: CliCommandArguments<Record<string, unknown>>,\n  context: CliCommandContext,\n): Promise<void> {\n  const {apiClient, chalk, output, prompt} = context\n\n  const client = apiClient({\n    requireUser: true,\n    requireProject: true,\n  })\n\n  // Check that the project has a studio hostname\n  let spinner = output.spinner('Checking project info').start()\n  const project = await client.projects.getById(client.config().projectId as string)\n  const studioHost = project && project.studioHost\n  spinner.succeed()\n\n  if (!studioHost) {\n    output.print('Your project has not been assigned a studio hostname.')\n    output.print('Nothing to undeploy.')\n    return\n  }\n\n  // Double-check\n  output.print('')\n\n  const url = `https://${chalk.yellow(studioHost)}.sanity.studio`\n  const shouldUndeploy = await prompt.single({\n    type: 'confirm',\n    default: false,\n    message: `This will undeploy ${url} and make it unavailable for your users.\n  The hostname will be available for anyone to claim.\n  Are you ${chalk.red('sure')} you want to undeploy?`.trim(),\n  })\n\n  if (!shouldUndeploy) {\n    return\n  }\n\n  const projectId = client.config().projectId\n  const uri = `/projects/${projectId}`\n\n  spinner = output.spinner('Undeploying studio').start()\n  try {\n    await client.request({uri, method: 'PATCH', body: {studioHost: null}})\n    spinner.succeed()\n  } catch (err) {\n    spinner.fail()\n    throw err\n  }\n\n  output.print(\n    `Studio undeploy scheduled. It might take a few minutes before ${url} is unavailable.`,\n  )\n}\n"],"names":[],"mappings":";AAE8B,eAAA,eAC5B,MACA,SACe;AACT,QAAA,EAAC,WAAW,OAAO,QAAQ,WAAU,SAErC,SAAS,UAAU;AAAA,IACvB,aAAa;AAAA,IACb,gBAAgB;AAAA,EAAA,CACjB;AAGD,MAAI,UAAU,OAAO,QAAQ,uBAAuB,EAAE,MAAM;AAC5D,QAAM,UAAU,MAAM,OAAO,SAAS,QAAQ,OAAO,OAAO,EAAE,SAAmB,GAC3E,aAAa,WAAW,QAAQ;AAGtC,MAFA,QAAQ,WAEJ,CAAC,YAAY;AACf,WAAO,MAAM,uDAAuD,GACpE,OAAO,MAAM,sBAAsB;AACnC;AAAA,EACF;AAGA,SAAO,MAAM,EAAE;AAEf,QAAM,MAAM,WAAW,MAAM,OAAO,UAAU,CAAC;AAS3C,MAAA,CARmB,MAAM,OAAO,OAAO;AAAA,IACzC,MAAM;AAAA,IACN,SAAS;AAAA,IACT,SAAS,sBAAsB,GAAG;AAAA;AAAA,YAE1B,MAAM,IAAI,MAAM,CAAC,yBAAyB,KAAK;AAAA,EAAA,CACxD;AAGC;AAIF,QAAM,MAAM,aADM,OAAO,SAAS,SACA;AAElC,YAAU,OAAO,QAAQ,oBAAoB,EAAE,MAAM;AACjD,MAAA;AACF,UAAM,OAAO,QAAQ,EAAC,KAAK,QAAQ,SAAS,MAAM,EAAC,YAAY,KAAI,EAAA,CAAE,GACrE,QAAQ,QAAQ;AAAA,WACT,KAAK;AACZ,UAAA,QAAQ,KACF,GAAA;AAAA,EACR;AAEO,SAAA;AAAA,IACL,iEAAiE,GAAG;AAAA,EAAA;AAExE;;"}